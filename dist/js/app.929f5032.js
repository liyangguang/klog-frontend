(function(t){function e(e){for(var a,o,i=e[0],c=e[1],u=e[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(p.length)p.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,i=1;i<n.length;i++){var c=n[i];0!==s[c]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},s={app:0},r=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0b86":function(t,e,n){t.exports=n.p+"img/camera.ae722111.svg"},"0cce":function(t,e,n){},"0eb9":function(t,e,n){"use strict";var a=n("2813"),s=n.n(a);s.a},"1bf1":function(t,e,n){"use strict";var a=n("8c4b"),s=n.n(a);s.a},2813:function(t,e,n){},"2c7f":function(t,e,n){t.exports=n.p+"img/speech-bubble.187c8efb.svg"},3547:function(t,e,n){t.exports=n.p+"img/phone.a0ada1a1.png"},3893:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e623"),n("e379"),n("5dc8"),n("37e1");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.isEmbed?t._e():n("my-header"),n("router-view")],1)},r=[],o=(n("caad"),n("2532"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{class:{"-scrolled":t.isScrolled}},[n("router-link",{staticClass:"logo",attrs:{to:"/"}},[t._v("KLog")]),n("nav",["/signin"!==t.$route.path?[t.isSignedin?n("ant-button",{on:{click:t.signout}},[t._v("注销")]):n("ant-button",{attrs:{type:"primary"},on:{click:function(e){return t.navigateTo("signin")}}},[t._v("登录")])]:t._e(),t.isSignedin&&"/"===t.$route.path?n("ant-button",{attrs:{type:"primary"},on:{click:function(e){return t.navigateTo("courses")}}},[t._v("课程管理入口")]):t._e()],2)],1)}),i=[],c=n("5efb"),u=60,l={components:{AntButton:c["a"]},data:function(){return{isScrolled:!1}},computed:{isSignedin:function(){return!!this.$store.state.currentUser}},created:function(){var t=this;window.addEventListener("scroll",(function(){t.isScrolled=window.scrollY>u}))},methods:{navigateTo:function(t){this.$router.push(t)},signout:function(){this.$store.commit("signout"),this.navigateTo("/")}}},d=l,p=(n("1bf1"),n("2877")),m=Object(p["a"])(d,o,i,!1,null,"64b9382d",null),h=m.exports,f={components:{myHeader:h},data:function(){return{isEmbed:this._checkEmbed(this.$route.path)}},watch:{$route:function(t){this.isEmbed=this._checkEmbed(t.path)}},methods:{_checkEmbed:function(t){return t.includes("_embed")}}},_=f,b=(n("c637"),Object(p["a"])(_,s,r,!1,null,"36f8e231",null)),g=b.exports,v=(n("d3b7"),n("ac1f"),n("5319"),n("1276"),n("96cf"),n("8c4f")),C=n("2f62"),x=n("a78e"),k=n.n(x);a["a"].use(C["a"]);var w="klog-user-pid",y=new C["a"].Store({state:{currentUser:null},mutations:{setCurrentUser:function(t,e){t.currentUser=e.user,e.save?k.a.set(w,e.user.pid,{expires:30}):!1===e.save&&k.a.remove(w)},signout:function(t){t.currentUser=null,k.a.remove(w)}}}),R=(n("99af"),n("a15b"),n("d81d"),n("4fad"),n("e587")),S=n("6c27"),M="https://klogserver.westus2.cloudapp.azure.com/api/0/",E="all";function A(t){var e,n,a,s,r,o,i=arguments;return regeneratorRuntime.async((function(c){while(1)switch(c.prev=c.next){case 0:return e=i.length>1&&void 0!==i[1]?i[1]:{},n=i.length>2?i[2]:void 0,a={},s="",n?(e.teacher_key&&(e.teacher_key=Object(S["sha256"])(e.teacher_key)),a={method:n,body:JSON.stringify(e)}):(e.pid||(e.pid=E),s=Object.entries(e).map((function(t){var e=Object(R["a"])(t,2),n=e[0],a=e[1];return"".concat(n,"=").concat(a)})).join("&"),s&&(s="?"+s)),c.next=7,regeneratorRuntime.awrap(fetch("".concat(M).concat(t).concat(s),a));case 7:return r=c.sent,c.next=10,regeneratorRuntime.awrap(r.json());case 10:if(o=c.sent,!r.ok){c.next=15;break}return c.abrupt("return",o.payload);case 15:throw new Error(o.message);case 16:case"end":return c.stop()}}))}var T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("main",[a("div",{staticClass:"content"},[a("div",{staticClass:"left"},[a("h1",[t._v("KLog")]),a("p",[t._v("记录学生们上课的精彩瞬间, 自动生成每个学生的精彩片段")]),t._m(0),a("ant-button",{attrs:{ghost:"",type:"primary",icon:"download",size:"large"}},[t._v("安卓应用市场")])],1),a("img",{staticClass:"right",attrs:{src:n("3547"),alt:"Phone frame"}})]),t._l(t.photos,(function(e,n){return a("div",{staticClass:"background-photo",style:{opacity:n===t.photoIndex?1:0,"background-image":"url("+e+")"}})}))],2)},L=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"features"},[a("li",[a("img",{attrs:{src:n("0b86"),alt:"camera icon"}}),a("p",[t._v("用手机记录下学生们的上课活动")])]),a("li",[a("img",{attrs:{src:n("f623"),alt:"neural icon"}}),a("p",[t._v("机器学习识别每个学生, 生成视频")])]),a("li",[a("img",{attrs:{src:n("2c7f"),alt:"speech bubble icon"}}),a("p",[t._v("老师向家长们分享每个孩子的精彩片段")])])])}],O=5e3,$={components:{AntButton:c["a"]},data:function(){return{photoIndex:0,photos:[n("c216"),n("cff0"),n("cd59"),n("a488")]}},created:function(){var t=this;setInterval((function(){t.photoIndex=(t.photoIndex+1)%t.photos.length}),O)}},I=$,U=(n("0eb9"),Object(p["a"])(I,T,L,!1,null,"21705dec",null)),P=U.exports,N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[n("h1",[t._v("课程管理")]),n("p",[t._v(t._s(t.pageMessage))]),n("div",{staticClass:"grid"},[t._l(t.courses,(function(e,a){return n("ant-card",{key:a,attrs:{title:e.course_name}},[n("ant-button",{attrs:{slot:"extra",shape:"circle",icon:"edit","aria-label":"编辑课程"},on:{click:function(n){return t.editButton(e)}},slot:"extra"}),n("p",{staticClass:"teacher"},[t._v("老师: "+t._s(t.getTeacherName(e.teacher_pid)))]),n("p",{staticClass:"teacher"},[t._v("助教: "+t._s(t.getTeacherName(e.assistant_pid)))]),n("p",{staticClass:"more"},[t._v("课程信息: "+t._s(e.course_intro))]),n("ant-button",{attrs:{size:"small"},on:{click:function(n){return t.openStudents(e.pid)}}},[t._v("管理学生"),e.studentCount?n("span",[t._v("("+t._s(e.studentCount)+")")]):t._e()])],1)})),n("ant-card",{attrs:{title:"添加新课程",bodyStyle:{"min-height":"10em","text-align":"center"}}},[n("ant-button",{staticClass:"add-button",attrs:{type:"primary",shape:"circle",icon:"plus",size:"large","aria-label":"添加"},on:{click:t.addButton}})],1)],2),n("ant-modal",{attrs:{title:t.modalContent.pid?"编辑课程":"添加新课程",visible:t.isModalVisible,okText:"确认",cancelText:"取消"},on:{ok:t.modalOk,cancel:function(e){t.isModalVisible=!1}}},[n("ant-form",{attrs:{formLayout:"horizontal"}},[n("ant-form-item",{attrs:{label:"名称","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.modalContent.course_name,callback:function(e){t.$set(t.modalContent,"course_name",e)},expression:"modalContent.course_name"}})],1),n("ant-form-item",{attrs:{label:"老师","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.modalContent.teacher_pid,callback:function(e){t.$set(t.modalContent,"teacher_pid",e)},expression:"modalContent.teacher_pid"}},t._l(t.teacherList,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.teacher_name))])})),1)],1),n("ant-form-item",{attrs:{label:"助教","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.modalContent.assistant_pid,callback:function(e){t.$set(t.modalContent,"assistant_pid",e)},expression:"modalContent.assistant_pid"}},t._l(t.teacherList,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.teacher_name))])})),1)],1),n("ant-form-item",{attrs:{label:"介绍","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.modalContent.course_intro,callback:function(e){t.$set(t.modalContent,"course_intro",e)},expression:"modalContent.course_intro"}})],1),n("p",[t._v(t._s(t.modalMessage))])],1)],1)],1)},j=[],V=(n("4de4"),n("4160"),n("0d03"),n("159b"),n("cdeb")),B=n("ed3b"),D=n("3af3"),F=n("b558"),z=n("9839"),W="000000000000000000000000",J={data:function(){return{teacherList:[]}},created:function(){this._loadTeacherList()},methods:{_loadTeacherList:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return t={fkey:"institute_pid",fid:this.$store.state.currentUser.institute_pid},e.prev=1,e.next=4,regeneratorRuntime.awrap(A("config/teacher",t));case 4:this.teacherList=e.sent,e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),console.error(e.t0),this.teacherList=[{pid:null,teacher_name:"获取教师列表失败"}];case 11:case 12:case"end":return e.stop()}}),null,this,[[1,7]])},getTeacherName:function(t){if(!t||t===W)return"(无)";if(!this.teacherList.length)return"(载入中)";var e=this.teacherList.filter((function(e){return e.pid===t}))[0];return e?e.teacher_name:"(未找到)"}}},K={data:function(){return{studentList:[]}},created:function(){this._loadAllStudents()},methods:{_loadAllStudents:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(A("config/student"));case 3:this.studentList=t.sent,t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error(t.t0),this.studentList=[{student_name:"获取学生列表失败"}];case 10:case 11:case"end":return t.stop()}}),null,this,[[0,6]])},getStudentName:function(t){if(!t||t===W)return"(无)";if(!this.studentList||!this.studentList.length)return"(载入中)";var e=this.studentList.filter((function(e){return e.pid===t}))[0];return e?e.student_name:"(未找到)"}}},Q={mixins:[J],components:{AntButton:c["a"],AntCard:V["a"],AntModal:B["a"],AntForm:D["a"],AntFormItem:D["a"].Item,AntInput:F["a"],AntSelect:z["b"],AntSelectOption:z["b"].Option},data:function(){return{courses:[],isModalVisible:!1,modalContent:{},modalMessage:"",pageMessage:""}},created:function(){this._loadCourses()},methods:{_loadCourses:function(){var t=this;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(A("config/course"));case 3:e.t0=function(e){return[e.teacher_pid,e.assistant_pid].includes(t.$store.state.currentUser.pid)},this.courses=e.sent.filter(e.t0),this.courses.forEach((function(e){t._loadCourseStudentsRefs(e)})),e.next=12;break;case 8:e.prev=8,e.t1=e["catch"](0),console.error(e.t1),this.pageMessage="获取课程列表失败. "+e.t1.message;case 12:case 13:case"end":return e.stop()}}),null,this,[[0,8]])},_loadCourseStudentsRefs:function(t){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=this,e.t1=t,e.next=5,regeneratorRuntime.awrap(A("config/reference/student_course",{student_pid:"all",course_pid:t.pid}));case 5:e.t2=e.sent.length,e.t0.$set.call(e.t0,e.t1,"studentCount",e.t2),e.next=13;break;case 9:e.prev=9,e.t3=e["catch"](0),console.error(e.t3),this.$set(t,"studentCount","(获取学生人数失败)");case 13:case 14:case"end":return e.stop()}}),null,this,[[0,9]])},addButton:function(){this.modalContent={teacher_pid:this.$store.state.currentUser.pid,institute_pid:this.$store.state.currentUser.institute_pid,course_targets:[]},this.isModalVisible=!0},editButton:function(t){this.modalContent=t,this.isModalVisible=!0},modalOk:function(){var t,e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return t=!this.modalContent.pid,t&&(this.modalContent.course_uid="uid-"+(new Date).getTime()),n.prev=2,n.next=5,regeneratorRuntime.awrap(A("config/course",this.modalContent,t?"POST":"PUT"));case 5:e=n.sent,t&&(this.modalContent.pid=e,this.courses.push(this.modalContent)),this.isModalVisible=!1,n.next=14;break;case 10:n.prev=10,n.t0=n["catch"](2),console.error(n.t0),this.modalMessage=n.t0.message;case 14:case 15:case"end":return n.stop()}}),null,this,[[2,10]])},openStudents:function(t){this.$router.push("/students/".concat(t))}}},H=Q,Y=(n("cc8b"),Object(p["a"])(H,N,j,!1,null,"b08d9672",null)),q=Y.exports,G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[n("router-link",{attrs:{to:"/courses"}},[t._v("返回课程列表")]),n("h1",[t._v("学生管理")]),n("p",[t._v(t._s(t.pageMessage))]),n("p",[t._v(t._s(t.course.course_name))]),n("p",{staticClass:"teacher"},[t._v("老师: "+t._s(t.getTeacherName(t.course.teacher_pid)))]),n("p",{staticClass:"teacher"},[t._v("助教: "+t._s(t.getTeacherName(t.course.assistant_pid)))]),n("div",{staticClass:"grid"},[t._l(t.currentCourseStudentRefs,(function(e,a){return n("ant-card",{key:a},[n("p",[t._v(t._s(t.getStudentName(e.student_pid)))])])})),n("ant-card",{attrs:{bodyStyle:{"min-height":"10em","text-align":"center"}}},[n("ant-button",{staticClass:"add-button",attrs:{type:"primary",shape:"circle",icon:"plus",size:"large","aria-label":"添加"},on:{click:t.addButton}})],1)],2),n("ant-modal",{attrs:{title:"添加学生",visible:t.isModalVisible,okText:"确认",cancelText:"取消"},on:{ok:t.modalOk,cancel:function(e){t.isModalVisible=!1}}},[n("ant-form",{attrs:{formLayout:"horizontal"}},[n("ant-form-item",{attrs:{label:"学生列表","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.modalContent.student_pid,callback:function(e){t.$set(t.modalContent,"student_pid",e)},expression:"modalContent.student_pid"}},[t._l(t.availableStudents,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.student_name))])})),n("ant-select-option",{attrs:{value:t.NEW_STUDENT_VALUE}},[t._v("[注册新学生]")])],2)],1),t.modalContent.student_pid===t.NEW_STUDENT_VALUE?[n("ant-form-item",{attrs:{label:"姓名","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.modalContent.student_name,callback:function(e){t.$set(t.modalContent,"student_name",e)},expression:"modalContent.student_name"}})],1)]:t._e(),n("p",[t._v(t._s(t.modalMessage))])],2)],1)],1)},X=[],Z=(n("7db0"),"CREATE_NEW"),tt={mixins:[J,K],components:{AntButton:c["a"],AntCard:V["a"],AntModal:B["a"],AntForm:D["a"],AntFormItem:D["a"].Item,AntInput:F["a"],AntSelect:z["b"],AntSelectOption:z["b"].Option},data:function(){return{course:{},isModalVisible:!1,modalContent:{},modalMessage:"",pageMessage:"",currentCourseStudentRefs:[],NEW_STUDENT_VALUE:Z}},computed:{availableStudents:function(){var t=this;return this.studentList?this.studentList.filter((function(e){return!t.currentCourseStudentRefs.find((function(t){return t.student_pid===e.pid}))})):[]}},created:function(){this._loadCourse(),this._loadCourseStudentsRefs()},methods:{_loadCourse:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(A("config/course",{pid:this.$route.params.coursePid}));case 3:this.course=t.sent[0],t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error(t.t0),this.pageMessage="获取课程信息失败. "+t.t0.message;case 10:case 11:case"end":return t.stop()}}),null,this,[[0,6]])},_loadCourseStudentsRefs:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(A("config/reference/student_course",{student_pid:"all",course_pid:this.$route.params.coursePid}));case 3:this.currentCourseStudentRefs=t.sent,t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error(t.t0),this.pageMessage="获取学生列表失败. "+t.t0.message;case 10:case 11:case"end":return t.stop()}}),null,this,[[0,6]])},addButton:function(){this.modalContent={},this.isModalVisible=!0},modalOk:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.modalContent.student_pid!==Z){e.next=14;break}return e.next=4,regeneratorRuntime.awrap(A("config/student",this.modalContent,"POST"));case 4:return t=e.sent,e.t0=this.studentList,e.next=8,regeneratorRuntime.awrap(A("config/student",{pid:t}));case 8:return e.t1=e.sent[0],e.t0.push.call(e.t0,e.t1),e.next=12,regeneratorRuntime.awrap(this._addStudentCourseRelationship(t));case 12:e.next=16;break;case 14:return e.next=16,regeneratorRuntime.awrap(this._addStudentCourseRelationship(this.modalContent.student_pid));case 16:e.next=22;break;case 18:e.prev=18,e.t2=e["catch"](0),console.error(e.t2),this.modalMessage=e.t2.message;case 22:case"end":return e.stop()}}),null,this,[[0,18]])},_addStudentCourseRelationship:function(t){var e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e={course_pid:this.$route.params.coursePid,student_pid:t},n.next=4,regeneratorRuntime.awrap(A("config/reference/student_course",e,"POST"));case 4:this.currentCourseStudentRefs.push(e),this.isModalVisible=!1,n.next=12;break;case 8:n.prev=8,n.t0=n["catch"](0),console.error(n.t0),this.modalMessage="添加学生失败. "+n.t0.message;case 12:case 13:case"end":return n.stop()}}),null,this,[[0,8]])}}},et=tt,nt=(n("5c53"),Object(p["a"])(et,G,X,!1,null,"34f588a7",null)),at=nt.exports,st=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[n("ant-form",{attrs:{formLayout:"horizontal"}},[n("ant-form-item",{attrs:{label:"账号","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.teacher_uid,callback:function(e){t.teacher_uid=e},expression:"teacher_uid"}})],1),n("ant-form-item",{attrs:{label:"密码","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input-password",{model:{value:t.teacher_key,callback:function(e){t.teacher_key=e},expression:"teacher_key"}})],1),t.isRegistering?[n("ant-form-item",{attrs:{label:"姓名","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.teacher_name,callback:function(e){t.teacher_name=e},expression:"teacher_name"}})],1),n("ant-form-item",{attrs:{label:"邮箱","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{attrs:{type:"email"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1),n("ant-form-item",{attrs:{label:"电话","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{attrs:{type:"tel"},model:{value:t.phone_number,callback:function(e){t.phone_number=e},expression:"phone_number"}})],1),n("ant-form-item",{attrs:{label:"学校","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.institute_pid,callback:function(e){t.institute_pid=e},expression:"institute_pid"}},t._l(t.instituteList,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.institute_name))])})),1)],1),n("p",[n("ant-button",{attrs:{type:"primary",size:"large"},on:{click:t.register}},[t._v("注册")])],1),n("p",[n("ant-button",{attrs:{type:"link"},on:{click:function(e){t.isRegistering=!1}}},[t._v("已有账号? 登录")])],1)]:[n("p",[n("ant-checkbox",{attrs:{checked:t.doSaveInCookie},on:{change:function(e){t.doSaveInCookie=e.target.checked}}},[t._v("下次自动登录")])],1),n("p",[n("ant-button",{attrs:{type:"primary",size:"large"},on:{click:t.login}},[t._v("登录")])],1),n("p",[n("ant-button",{attrs:{type:"link"},on:{click:function(e){t.isRegistering=!0}}},[t._v("注册教师账号")])],1)],n("p",[t._v(t._s(t.message))])],2)],1)},rt=[],ot=n("bb76"),it={components:{AntButton:c["a"],AntForm:D["a"],AntFormItem:D["a"].Item,AntInput:F["a"],AntInputPassword:F["a"].Password,AntCheckbox:ot["a"],AntSelect:z["b"],AntSelectOption:z["b"].Option},data:function(){return{isRegistering:!1,doSaveInCookie:!1,message:"",teacher_uid:"",teacher_key:"",teacher_name:"",phone_number:"",email:"",institute_pid:"",instituteList:[]}},created:function(){this._loadInstituteList()},methods:{_loadInstituteList:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(A("config/institute"));case 3:this.instituteList=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),this.instituteList=[{institute_name:"获取学校列表失败"}];case 9:case 10:case"end":return t.stop()}}),null,this,[[0,6]])},login:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return t={teacher_uid:this.teacher_uid,teacher_key:this.teacher_key},e.prev=1,e.t0=this.$store,e.next=5,regeneratorRuntime.awrap(A("workflow/teacher/login",t,"POST"));case 5:e.t1=e.sent,e.t2=this.doSaveInCookie,e.t3={user:e.t1,save:e.t2},e.t0.commit.call(e.t0,"setCurrentUser",e.t3),this.$router.push("/courses"),e.next=15;break;case 12:e.prev=12,e.t4=e["catch"](1),this.message=e.t4.message;case 15:case 16:case"end":return e.stop()}}),null,this,[[1,12]])},register:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:if(this.isRegistering){e.next=3;break}return this.isRegistering=!0,e.abrupt("return");case 3:return t={teacher_uid:this.teacher_uid,teacher_key:this.teacher_key,teacher_name:this.teacher_name,phone_number:this.phone_number,email:this.email,institute_pid:this.institute_pid},e.prev=4,e.next=7,regeneratorRuntime.awrap(A("config/teacher",t,"POST"));case 7:this.$router.go(),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),this.message=e.t0.message;case 13:case 14:case"end":return e.stop()}}),null,this,[[4,10]])}}},ct=it,ut=(n("951a"),Object(p["a"])(ct,st,rt,!1,null,"2ad571b4",null)),lt=ut.exports,dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{ref:"formEl",attrs:{enctype:t.REQUIRED_FILED_FOR_MULTIPART}},[n("p",[t._v("This is a page to test the upload feature, not a real page in the app.")]),n("p",[t._v(t._s(t.message))]),n("input",{attrs:{type:"file",name:t.FORM_FILED_NAME},on:{change:function(e){t.file=e.target.files[0]}}}),n("ant-button",{attrs:{disabled:!t.file||t.isDisabled},on:{click:t.submit}},[t._v("Upload Image")]),t.url?n("img",{attrs:{src:t.url}}):t._e()],1)},pt=[],mt="/_api/upload",ht="multipart/form-data",ft="image",_t={components:{AntButton:c["a"]},data:function(){return{file:null,message:"Select an image to upload",url:"",isDisabled:!1,REQUIRED_FILED_FOR_MULTIPART:ht,FORM_FILED_NAME:ft}},methods:{submit:function(){var t=this;this.isDisabled=!0,this.message="Uploading...";var e=new FormData(this.$refs.formEl);fetch(mt,{method:"POST",body:e}).then((function(t){if(!t.ok)throw new Error("".concat(t.status," ").concat(t.statusText));return t.json()})).then((function(e){t.message="Uploaded successfully",t.url=e.path,t.isDisabled=!1})).catch((function(e){t.message="Failed to upload. "+e.message,t.isDisabled=!1}))}}},bt=_t,gt=(n("df18"),Object(p["a"])(bt,dt,pt,!1,null,"a5f4b786",null)),vt=gt.exports,Ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[t.pageMessage?n("p",[t._v(t._s(t.pageMessage))]):t._e(),n("ant-list",{staticClass:"list",attrs:{dataSource:t.courses},scopedSlots:t._u([{key:"renderItem",fn:function(e,a){return n("ant-list-item",{},[n("ant-list-item-meta",{attrs:{title:e.course_name}},[n("div",{attrs:{slot:"description"},slot:"description"},[n("span",{staticClass:"teacher"},[t._v("老师: "+t._s(t.getTeacherName(e.teacher_pid))+", ")]),n("span",{staticClass:"teacher"},[t._v("助教: "+t._s(t.getTeacherName(e.assistant_pid))+", ")]),n("span",{staticClass:"more"},[t._v("课程信息: "+t._s(e.course_intro))])])]),n("ant-button",{attrs:{slot:"actions",shape:"circle",icon:"edit","aria-label":"编辑课程"},on:{click:function(n){return t.editButton(e)}},slot:"actions"}),n("ant-button",{attrs:{slot:"actions",size:"small"},on:{click:function(n){return t.openStudents(e.pid)}},slot:"actions"},[t._v("管理学生"),e.studentCount?n("span",[t._v("("+t._s(e.studentCount)+")")]):t._e()])],1)}}])}),n("ant-button",{staticClass:"add-button",attrs:{slot:"actions",icon:"plus",size:"large"},on:{click:t.addButton},slot:"actions"},[t._v("添加新课程")]),n("ant-modal",{attrs:{title:t.modalContent.pid?"编辑课程":"添加新课程",visible:t.isModalVisible,okText:"确认",cancelText:"取消"},on:{ok:t.modalOk,cancel:function(e){t.isModalVisible=!1}}},[n("ant-form",{attrs:{formLayout:"horizontal"}},[n("ant-form-item",{attrs:{label:"名称","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.modalContent.course_name,callback:function(e){t.$set(t.modalContent,"course_name",e)},expression:"modalContent.course_name"}})],1),n("ant-form-item",{attrs:{label:"老师","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.modalContent.teacher_pid,callback:function(e){t.$set(t.modalContent,"teacher_pid",e)},expression:"modalContent.teacher_pid"}},t._l(t.teacherList,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.teacher_name))])})),1)],1),n("ant-form-item",{attrs:{label:"助教","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.modalContent.assistant_pid,callback:function(e){t.$set(t.modalContent,"assistant_pid",e)},expression:"modalContent.assistant_pid"}},t._l(t.teacherList,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.teacher_name))])})),1)],1),n("ant-form-item",{attrs:{label:"介绍","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.modalContent.course_intro,callback:function(e){t.$set(t.modalContent,"course_intro",e)},expression:"modalContent.course_intro"}})],1),n("p",[t._v(t._s(t.modalMessage))])],1)],1)],1)},xt=[],kt=n("0c63"),wt=n("fe2b"),yt={mixins:[J],components:{AntIcon:kt["a"],AntButton:c["a"],AntForm:D["a"],AntFormItem:D["a"].Item,AntInput:F["a"],AntModal:B["a"],AntSelect:z["b"],AntSelectOption:z["b"].Option,AntList:wt["b"],AntListItem:wt["b"].Item,AntListItemMeta:wt["b"].Item.Meta},data:function(){return{courses:[],isModalVisible:!1,modalContent:{},modalMessage:"",pageMessage:""}},created:function(){this._loadCourses()},methods:{_loadCourses:function(){var t=this;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(A("config/course"));case 3:e.t0=function(e){return[e.teacher_pid,e.assistant_pid].includes(t.$store.state.currentUser.pid)},this.courses=e.sent.filter(e.t0),this.courses.forEach((function(e){t._loadCourseStudentsRefs(e)})),e.next=12;break;case 8:e.prev=8,e.t1=e["catch"](0),console.error(e.t1),this.pageMessage="获取课程列表失败. "+e.t1.message;case 12:case 13:case"end":return e.stop()}}),null,this,[[0,8]])},_loadCourseStudentsRefs:function(t){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=this,e.t1=t,e.next=5,regeneratorRuntime.awrap(A("config/reference/student_course",{student_pid:"all",course_pid:t.pid}));case 5:e.t2=e.sent.length,e.t0.$set.call(e.t0,e.t1,"studentCount",e.t2),e.next=13;break;case 9:e.prev=9,e.t3=e["catch"](0),console.error(e.t3),this.$set(t,"studentCount","(获取学生人数失败)");case 13:case 14:case"end":return e.stop()}}),null,this,[[0,9]])},addButton:function(){this.modalContent={teacher_pid:this.$store.state.currentUser.pid,institute_pid:this.$store.state.currentUser.institute_pid,course_targets:[]},this.isModalVisible=!0},editButton:function(t){this.modalContent=t,this.isModalVisible=!0},modalOk:function(){var t,e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return t=!this.modalContent.pid,t&&(this.modalContent.course_uid="uid-"+(new Date).getTime()),n.prev=2,n.next=5,regeneratorRuntime.awrap(A("config/course",this.modalContent,t?"POST":"PUT"));case 5:e=n.sent,t&&(this.modalContent.pid=e,this.courses.push(this.modalContent)),this.isModalVisible=!1,n.next=14;break;case 10:n.prev=10,n.t0=n["catch"](2),console.error(n.t0),this.modalMessage=n.t0.message;case 14:case 15:case"end":return n.stop()}}),null,this,[[2,10]])},openStudents:function(t){this.$router.push("/_embed/students/".concat(t))}}},Rt=yt,St=(n("b41c"),Object(p["a"])(Rt,Ct,xt,!1,null,"405b1c48",null)),Mt=St.exports,Et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[t.pageMessage?n("p",[t._v(t._s(t.pageMessage))]):t._e(),n("div",{staticClass:"course-info"},[n("router-link",{attrs:{to:"/_embed/courses"}},[t._v("返回课程列表")]),n("h1",[t._v(t._s(t.course.course_name))]),n("p",[n("span",{staticClass:"teacher"},[t._v("老师: "+t._s(t.getTeacherName(t.course.teacher_pid))+", ")]),n("span",{staticClass:"teacher"},[t._v("助教: "+t._s(t.getTeacherName(t.course.assistant_pid))+", ")]),n("span",{staticClass:"more"},[t._v("课程信息: "+t._s(t.course.course_intro))])]),n("h2",[t._v("学生列表")])],1),n("ant-list",{staticClass:"list",attrs:{dataSource:t.currentCourseStudentRefs},scopedSlots:t._u([{key:"renderItem",fn:function(e,a){return n("ant-list-item",{},[n("ant-list-item-meta",{attrs:{title:t.getStudentName(e.student_pid)}})],1)}}])}),n("ant-button",{staticClass:"add-button",attrs:{slot:"actions",icon:"plus",size:"large"},on:{click:t.addButton},slot:"actions"},[t._v("添加")]),n("ant-modal",{attrs:{title:"添加学生",visible:t.isModalVisible,okText:"确认",cancelText:"取消"},on:{ok:t.modalOk,cancel:function(e){t.isModalVisible=!1}}},[n("ant-form",{attrs:{formLayout:"horizontal"}},[n("ant-form-item",{attrs:{label:"学生列表","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-select",{model:{value:t.modalContent.student_pid,callback:function(e){t.$set(t.modalContent,"student_pid",e)},expression:"modalContent.student_pid"}},[t._l(t.availableStudents,(function(e,a){return n("ant-select-option",{key:a,attrs:{value:e.pid}},[t._v(t._s(e.student_name))])})),n("ant-select-option",{attrs:{value:t.NEW_STUDENT_VALUE}},[t._v("[注册新学生]")])],2)],1),t.modalContent.student_pid===t.NEW_STUDENT_VALUE?[n("ant-form-item",{attrs:{label:"姓名","label-col":{span:4},"wrapper-col":{span:20}}},[n("ant-input",{model:{value:t.modalContent.student_name,callback:function(e){t.$set(t.modalContent,"student_name",e)},expression:"modalContent.student_name"}})],1)]:t._e(),n("p",[t._v(t._s(t.modalMessage))])],2)],1)],1)},At=[],Tt="CREATE_NEW",Lt={mixins:[J,K],components:{AntButton:c["a"],AntModal:B["a"],AntForm:D["a"],AntFormItem:D["a"].Item,AntInput:F["a"],AntSelect:z["b"],AntSelectOption:z["b"].Option,AntList:wt["b"],AntListItem:wt["b"].Item,AntListItemMeta:wt["b"].Item.Meta},data:function(){return{course:{},isModalVisible:!1,modalContent:{},modalMessage:"",pageMessage:"",currentCourseStudentRefs:[],NEW_STUDENT_VALUE:Tt}},computed:{availableStudents:function(){var t=this;return this.studentList?this.studentList.filter((function(e){return!t.currentCourseStudentRefs.find((function(t){return t.student_pid===e.pid}))})):[]}},created:function(){this._loadCourse(),this._loadCourseStudentsRefs()},methods:{_loadCourse:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(A("config/course",{pid:this.$route.params.coursePid}));case 3:this.course=t.sent[0],t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error(t.t0),this.pageMessage="获取课程信息失败. "+t.t0.message;case 10:case 11:case"end":return t.stop()}}),null,this,[[0,6]])},_loadCourseStudentsRefs:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(A("config/reference/student_course",{student_pid:"all",course_pid:this.$route.params.coursePid}));case 3:this.currentCourseStudentRefs=t.sent,t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error(t.t0),this.pageMessage="获取学生列表失败. "+t.t0.message;case 10:case 11:case"end":return t.stop()}}),null,this,[[0,6]])},addButton:function(){this.modalContent={},this.isModalVisible=!0},modalOk:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.modalContent.student_pid!==Tt){e.next=14;break}return e.next=4,regeneratorRuntime.awrap(A("config/student",this.modalContent,"POST"));case 4:return t=e.sent,e.t0=this.studentList,e.next=8,regeneratorRuntime.awrap(A("config/student",{pid:t}));case 8:return e.t1=e.sent[0],e.t0.push.call(e.t0,e.t1),e.next=12,regeneratorRuntime.awrap(this._addStudentCourseRelationship(t));case 12:e.next=16;break;case 14:return e.next=16,regeneratorRuntime.awrap(this._addStudentCourseRelationship(this.modalContent.student_pid));case 16:e.next=22;break;case 18:e.prev=18,e.t2=e["catch"](0),console.error(e.t2),this.modalMessage=e.t2.message;case 22:case"end":return e.stop()}}),null,this,[[0,18]])},_addStudentCourseRelationship:function(t){var e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e={course_pid:this.$route.params.coursePid,student_pid:t},n.next=4,regeneratorRuntime.awrap(A("config/reference/student_course",e,"POST"));case 4:this.currentCourseStudentRefs.push(e),this.isModalVisible=!1,n.next=12;break;case 8:n.prev=8,n.t0=n["catch"](0),console.error(n.t0),this.modalMessage="添加学生失败. "+n.t0.message;case 12:case 13:case"end":return n.stop()}}),null,this,[[0,8]])}}},Ot=Lt,$t=(n("b268"),Object(p["a"])(Ot,Et,At,!1,null,"b461845e",null)),It=$t.exports;a["a"].use(v["a"]);var Ut=function(t,e,n){var a,s;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:if(a=k.a.get(w)||(y.state.currentUser||{}).pid,!a){e.next=8;break}return e.t0=y,e.next=5,regeneratorRuntime.awrap(A("config/teacher",{pid:a}));case 5:e.t1=e.sent[0],e.t2={user:e.t1},e.t0.commit.call(e.t0,"setCurrentUser",e.t2);case 8:e.t3=t.path.split("/")[1],e.next=""===e.t3?11:"signin"===e.t3?13:"courses"===e.t3?15:"students"===e.t3?15:"_embed"===e.t3?17:26;break;case 11:return n(),e.abrupt("break",26);case 13:return a?Nt.replace("courses"):n(),e.abrupt("break",26);case 15:return a?n():Nt.replace("signin"),e.abrupt("break",26);case 17:return s="5df9855369c14386d2d42222",e.t4=y,e.next=21,regeneratorRuntime.awrap(A("config/teacher",{pid:s}));case 21:return e.t5=e.sent[0],e.t6={user:e.t5},e.t4.commit.call(e.t4,"setCurrentUser",e.t6),n(),e.abrupt("break",26);case 26:case"end":return e.stop()}}))},Pt=[{path:"/",component:P,beforeEnter:Ut},{path:"/signin",component:lt,beforeEnter:Ut},{path:"/courses",component:q,beforeEnter:Ut},{path:"/students/:coursePid",component:at,beforeEnter:Ut},{path:"/_embed/courses",component:Mt,beforeEnter:Ut},{path:"/_embed/students/:coursePid",component:It,beforeEnter:Ut},{path:"/_embed/upload",component:vt},{path:"*",redirect:"/"}],Nt=new v["a"]({mode:"history",base:"/",routes:Pt}),jt=Nt;n("202f");a["a"].config.productionTip=!1,new a["a"]({router:jt,store:y,render:function(t){return t(g)}}).$mount("#app")},"5c53":function(t,e,n){"use strict";var a=n("3893"),s=n.n(a);s.a},"5ca9":function(t,e,n){},6373:function(t,e,n){},7972:function(t,e,n){},"8c4b":function(t,e,n){},"951a":function(t,e,n){"use strict";var a=n("ce39"),s=n.n(a);s.a},a488:function(t,e,n){t.exports=n.p+"img/4.c848b14a.jpg"},b268:function(t,e,n){"use strict";var a=n("ccd6"),s=n.n(a);s.a},b41c:function(t,e,n){"use strict";var a=n("5ca9"),s=n.n(a);s.a},c216:function(t,e,n){t.exports=n.p+"img/1.8eee14e7.jpg"},c637:function(t,e,n){"use strict";var a=n("0cce"),s=n.n(a);s.a},cc8b:function(t,e,n){"use strict";var a=n("6373"),s=n.n(a);s.a},ccd6:function(t,e,n){},cd59:function(t,e,n){t.exports=n.p+"img/3.3944809d.jpg"},ce39:function(t,e,n){},cff0:function(t,e,n){t.exports=n.p+"img/2.87141047.jpg"},df18:function(t,e,n){"use strict";var a=n("7972"),s=n.n(a);s.a},f623:function(t,e,n){t.exports=n.p+"img/neural.30d44924.svg"}});
//# sourceMappingURL=app.929f5032.js.map